<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <meta name="description" content="Checklist de Oficina - App Offline com PDF">
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
   <title id="titulo-pagina">Checklist de Entrada ‚Äì Oficina</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="container">
       <div class="header">
    <div class="logo-container">
        <img id="logo-oficina" src="logo.png" alt="Logo da Oficina">
    </div>
    <div class="header-content">
        <!-- ‚úÖ NEUTRO - PREENCHER NO CONFIG.JS -->
        <h1 id="nome-oficina">OFICINA</h1>
        <p id="subtitulo-oficina">Checklist de entrada e inspe√ß√£o veicular</p>
        <div class="contato-info">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="whatsapp-icon">
            <span id="telefone-oficina">(00) 00000-0000</span>
        </div>
        <div class="endereco-oficina" id="endereco-oficina">
            ENDERE√áO DA OFICINA
        </div>
        <div class="cnpj-oficina" id="cnpj-oficina">
    CNPJ: 00.000.000/0000-00
</div>


                <div class="status-sync">
                    <div class="sync-dot" id="syncStatus"></div>
                    <span id="syncText">Online</span>
                </div>
            </div>
            <div class="header-badge">v3.0 PRO</div>
        </div>
<div class="tabs">
    <button class="tab-button active" onclick="switchTab('novo-checklist')">‚ûï Novo Checklist</button>
    <button class="tab-button" onclick="switchTab('orcamento')">üí∞ Pe√ßas & Servi√ßos</button>
    <button class="tab-button" onclick="switchTab('fotos')">üì∏ Fotos</button>
    <button class="tab-button" onclick="switchTab('resumo'); atualizarResumoOS()">üìÑ Resumo</button>
    <button class="tab-button" onclick="switchTab('historico')">üìã Hist√≥rico</button>
    <button class="tab-button" onclick="switchTab('relatorios')">üìä Relat√≥rios</button>
</div>
        
        <!-- BARRA FIXA DE INFORMA√á√ïES DA OS -->
<div class="os-info-bar" style="
    background: #f8f9fa;
    border-bottom: 1px solid #ddd;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
">
    <div style="font-size: 13px; font-weight: 600; color: #555;">
        üõ†Ô∏è ORDEM DE SERVI√áO ATUAL
    </div>
    <div id="barraFixaOS" style="
        font-size: 18px; 
        font-weight: 900; 
        color: var(--color-primary); 
        letter-spacing: 1px;
    ">
        -
    </div>
</div>



        <!-- ABA PRINCIPAL - CHECKLIST -->
        <div id="novo-checklist" class="tab-content active">
            <div class="content">
                <div id="successMessage" class="alert alert-success"></div>
                <div id="errorMessage" class="alert alert-error"></div>
                <div id="infoMessage" class="alert alert-info"></div>

               <form id="checklistForm" class="wizard-form">

    <!-- BARRA DE PROGRESSO DO WIZARD -->
    <div class="wizard-progress">
        <div class="step-indicator active" onclick="showStep(1)" data-step="1">1. Ve√≠culo</div>
        <div class="step-indicator" onclick="showStep(2)" data-step="2">2. Inspe√ß√£o</div>
        <div class="step-indicator" onclick="showStep(3)" data-step="3">3. Cliente</div>
    </div>

    <!-- ================================================== -->
    <!-- PASSO 1: INFORMA√á√ïES DO VE√çCULO -->
    <!-- ================================================== -->
    <div class="wizard-step active" id="step1">
        <div class="section-title">üìã INFORMA√á√ïES DO VE√çCULO</div>

        <!-- RESUMO FIXO DO VE√çCULO (VISUAL) -->
        <div class="veiculo-resumo" id="resumoVeiculoPrincipal">
            <div class="veiculo-resumo-pill">Placa: <strong id="resumoPlaca">-</strong></div>
            <div class="veiculo-resumo-pill">Modelo: <strong id="resumoModelo">-</strong></div>
            <div class="veiculo-resumo-pill">KM: <strong id="resumoKmEntrada">-</strong></div>
            <div class="veiculo-resumo-pill">Data: <strong id="resumoData">-</strong></div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="placa">Placa *</label>
                <input type="text" id="placa" name="placa" placeholder="ABC-1234" maxlength="8" style="text-transform: uppercase;">
            </div>
            <div class="form-group">
                <label for="chassi">Chassi</label>
                <input type="text" id="chassi" name="chassi" placeholder="17 d√≠gitos" maxlength="17">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="modelo">Modelo</label>
                <input type="text" id="modelo" name="modelo" placeholder="Ex: Fiat Uno">
            </div>
            <div class="form-group">
                <label for="km_entrada">KM Entrada</label>
                <input type="text" id="km_entrada" name="km_entrada" placeholder="150.000">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="data">Data Entrada</label>
                <input type="date" id="data" name="data">
            </div>
            <div class="form-group">
                <label for="hora">Hora Entrada</label>
                <input type="time" id="hora" name="hora">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="combustivel">N√≠vel Combust√≠vel</label>
                <select id="combustivel" name="combustivel">
                    <option value="">Selecione...</option>
                    <option value="cheio">Cheio</option>
                    <option value="meio">Meio</option>
                    <option value="1/4">1/4</option>
                    <option value="vazio">Vazio</option>
                </select>
            </div>
            <div class="form-group">
                <label for="km_saida">KM Sa√≠da</label>
                <input type="text" id="km_saida" name="km_saida" placeholder="150.500">
            </div>
        </div>

        <!-- BOT√ïES DE NAVEGA√á√ÉO -->
        <div class="wizard-buttons right">
            <button type="button" class="btn-secondary" onclick="limparFormulario()">üóëÔ∏è Limpar</button>
            <button type="button" class="btn-primary" onclick="nextStep(2)">Pr√≥ximo ‚û°Ô∏è</button>
        </div>
    </div>


    <!-- ================================================== -->
    <!-- PASSO 2: INSPE√á√ÉO E CARACTER√çSTICAS -->
    <!-- ================================================== -->
    <div class="wizard-step" id="step2">
        <div class="section-title">üîç INSPE√á√ÉO VISUAL</div>

        <div class="equip-section">
            <div class="equip-section-title">üîß ACESS√ìRIOS OBRIGAT√ìRIOS</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="estepe" name="equipamentos" value="ESTEPE"><label for="estepe">ESTEPE</label></div>
                <div class="checkbox-item"><input type="checkbox" id="macaco" name="equipamentos" value="MACACO"><label for="macaco">MACACO</label></div>
                <div class="checkbox-item"><input type="checkbox" id="chave_roda" name="equipamentos" value="CHAVE DE RODA"><label for="chave_roda">CHAVE DE RODA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="triangulo" name="equipamentos" value="TRI√ÇNGULO"><label for="triangulo">TRI√ÇNGULO</label></div>
            </div>
        </div>

        <div class="equip-section">
            <div class="equip-section-title">‚õΩ TIPO COMBUST√çVEL</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="flex" name="equipamentos" value="FLEX"><label for="flex">FLEX</label></div>
                <div class="checkbox-item"><input type="checkbox" id="gasolina" name="equipamentos" value="GASOLINA"><label for="gasolina">GASOLINA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="etanol" name="equipamentos" value="ETANOL"><label for="etanol">ETANOL</label></div>
                <div class="checkbox-item"><input type="checkbox" id="gnv" name="equipamentos" value="GNV"><label for="gnv">GNV</label></div>
                <div class="checkbox-item"><input type="checkbox" id="diesel" name="equipamentos" value="DIESEL"><label for="diesel">DIESEL</label></div>
            </div>
        </div>

        <div class="equip-section">
            <div class="equip-section-title">üîä ELETR√îNICOS</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="radio" name="equipamentos" value="R√ÅDIO / MULTIM√çDIA"><label for="radio">R√ÅDIO / MULTIM√çDIA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="alarme_corta" name="equipamentos" value="ALARME / CORTA CORRENTE"><label for="alarme_corta">ALARME / CORTA CORRENTE</label></div>
                <div class="checkbox-item"><input type="checkbox" id="antena" name="equipamentos" value="ANTENA"><label for="antena">ANTENA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="acendedor" name="equipamentos" value="ACENDEDOR/TOMADA 12V"><label for="acendedor">ACENDEDOR/TOMADA 12V</label></div>
            </div>
        </div>

        <div class="equip-section">
            <div class="equip-section-title">‚ö° EL√âTRICOS</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="vidro_eletrico" name="equipamentos" value="VIDRO EL√âTRICO"><label for="vidro_eletrico">VIDRO EL√âTRICO</label></div>
                <div class="checkbox-item"><input type="checkbox" id="trava_eletrica" name="equipamentos" value="TRAVA EL√âTRICA"><label for="trava_eletrica">TRAVA EL√âTRICA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="buzina" name="equipamentos" value="BUZINA"><label for="buzina">BUZINA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="bateria" name="equipamentos" value="BATERIA"><label for="bateria">BATERIA</label></div>
            </div>
        </div>

        <div class="equip-section">
            <div class="equip-section-title">üõû RODAS & P√ÅRA-BRISAS</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="calotas" name="equipamentos" value="CALOTAS"><label for="calotas">CALOTAS</label></div>
                <div class="checkbox-item"><input type="checkbox" id="rodas_liga" name="equipamentos" value="RODAS DE LIGA"><label for="rodas_liga">RODAS DE LIGA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="roda_ferro" name="equipamentos" value="RODA DE FERRO"><label for="roda_ferro">RODA DE FERRO</label></div>
                <div class="checkbox-item"><input type="checkbox" id="para_brisa" name="equipamentos" value="PARABRISA TRINCADO"><label for="para_brisa">P√ÅRA BRISA TRINCADO</label></div>
            </div>
        </div>

        <div class="equip-section">
            <div class="equip-section-title">üì¶ DEMAIS ACESS√ìRIOS</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="extintor" name="equipamentos" value="EXTINTOR"><label for="extintor">EXTINTOR</label></div>
                <div class="checkbox-item"><input type="checkbox" id="protetor_carter" name="equipamentos" value="PROTETOR DE CARTER"><label for="protetor_carter">PROTETOR DE CARTER</label></div>
                <div class="checkbox-item"><input type="checkbox" id="chave_secreta" name="equipamentos" value="CHAVE SEGREDO (RODA)"><label for="chave_secreta">CHAVE SEGREDO (RODA)</label></div>
                <div class="checkbox-item"><input type="checkbox" id="tapetes" name="equipamentos" value="TAPETES"><label for="tapetes">TAPETES</label></div>
            </div>
        </div>

        <div class="equip-section">
            <div class="equip-section-title">‚≠ê EQUIPAMENTOS PRINCIPAIS</div>
            <div class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" id="ar" name="caracteristicas" value="AR"><label for="ar">AR</label></div>
                <div class="checkbox-item"><input type="checkbox" id="abs" name="caracteristicas" value="ABS"><label for="abs">ABS</label></div>
                <div class="checkbox-item"><input type="checkbox" id="airbag" name="caracteristicas" value="Air Bag"><label for="airbag">Air Bag</label></div>
            </div>
        </div>

        <div class="form-row">
            <div class="equip-section" style="flex: 1; margin-top: 0;">
                <div class="equip-section-title">üïπÔ∏è C√ÇMBIO</div>
                <div class="checkbox-group">
                    <div class="checkbox-item"><input type="checkbox" id="cambio_auto" name="cambio" value="Autom√°tico"><label for="cambio_auto">AUTOM√ÅTICO</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="cambio_manual" name="cambio" value="Manual"><label for="cambio_manual">MANUAL</label></div>
                </div>
            </div>

            <div class="equip-section" style="flex: 1; margin-top: 0;">
                <div class="equip-section-title">üöú TRA√á√ÉO</div>
                <div class="checkbox-group">
                    <div class="checkbox-item"><input type="checkbox" id="tracao_4x2" name="tracao" value="4x2"><label for="tracao_4x2">4x2</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tracao_4x4" name="tracao" value="4x4"><label for="tracao_4x4">4x4</label></div>
                </div>
            </div>
        </div>

        <div class="form-row full">
    <div class="form-group">
        <label for="obsInspecao">Observa√ß√µes da inspe√ß√£o</label>
        <textarea id="obsInspecao" name="obsInspecao"
                  placeholder="Ex.: Vazamento de √≥leo no motor, ar condicionado n√£o gela, lanterna traseira quebrada..."
                  style="height: 60px; min-height: 60px;"></textarea>
    </div>
</div>

        <!-- BOT√ïES DE NAVEGA√á√ÉO -->
        <div class="wizard-buttons">
            <button type="button" class="btn-secondary" onclick="prevStep(1)">‚¨ÖÔ∏è Voltar</button>
            <button type="button" class="btn-primary" onclick="nextStep(3)">Pr√≥ximo ‚û°Ô∏è</button>
        </div>
    </div>


    <!-- ================================================== -->
    <!-- PASSO 3: DADOS DO CLIENTE E FINALIZA√á√ÉO -->
    <!-- ================================================== -->
    <div class="wizard-step" id="step3">
        <div class="section-title">üë§ DADOS DO CLIENTE</div>

        <div class="form-row">
            <div class="form-group">
                <label for="nome_cliente">Nome *</label>
                <input type="text" id="nome_cliente" name="nome_cliente" placeholder="Nome completo do cliente">
            </div>
            <div class="form-group">
                <label for="cpf_cnpj">CPF / CNPJ</label>
                <input type="text" id="cpf_cnpj" name="cpf_cnpj" placeholder="000.000.000-00" maxlength="18">
            </div>
        </div>

        <div class="form-row full">
            <div class="form-group">
                <label for="endereco_cliente">Endere√ßo Completo</label>
                <textarea id="endereco_cliente" name="endereco_cliente" placeholder="Rua, n√∫mero, bairro, cidade - UF, CEP" style="height: 60px; min-height: 60px;"></textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="celular_cliente">Celular / WhatsApp *</label>
                <input type="tel" id="celular_cliente" name="celular_cliente" placeholder="(31) 99999-9999">
            </div>
            <div class="form-group">
                <label for="telefone2">Telefone 2 (opcional)</label>
                <input type="tel" id="telefone2" name="telefone2" placeholder="(31) 9999-9999">
            </div>
        </div>

        <div class="section-title">üîß SERVI√áOS/SOLICITADOS</div>

        <div class="form-row full">
            <div class="form-group">
                <label for="servicos">Descreva os servi√ßos solicitados:</label>
                <textarea id="servicos" name="servicos" placeholder="Ex: Troca de √≥leo e filtro, alinhamento e balanceamento..."></textarea>
            </div>
        </div>

        <!-- BOT√ïES DE NAVEGA√á√ÉO -->
        <div class="wizard-buttons">
            <button type="button" class="btn-secondary" onclick="prevStep(2)">‚¨ÖÔ∏è Voltar</button>
<button type="button" class="btn-primary" onclick="switchTab('orcamento')">Ir para Pe√ßas & Servi√ßos ‚û°Ô∏è</button>
        </div>
    </div>

</form>
            </div>
        </div>

        <!-- ABA HIST√ìRICO -->
        <div id="historico" class="tab-content">
            <div class="content">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Buscar por placa, modelo ou cliente..." onkeyup="filtrarChecklists()">
                    <button class="btn-secondary btn-small" onclick="ordenarChecklists()">üìä Ordenar</button>
                </div>

                <div id="checklistsList"></div>
                <div id="emptyMessage" style="text-align: center; padding: 40px; color: #999;">
                    <p style="font-size: 40px; margin-bottom: 10px;">üì≠</p>
                    <p>Nenhum checklist salvo ainda. Crie um novo para come√ßar!</p>
                </div>
            </div>
        </div>

        <!-- ABA RELAT√ìRIOS -->
        <div id="relatorios" class="tab-content">
            <div class="content">
                <div class="section-title">üìä ESTAT√çSTICAS GERAIS</div>
                <div class="stats-box">
                    <div class="stat-card">
                        <div class="stat-number" id="totalChecklists">0</div>
                        <div class="stat-label">Checklists Salvos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="checklistsMes">0</div>
                        <div class="stat-label">Checklists M√™s Atual</div>
                    </div>
                </div>

                <div class="section-title">üöó MARCAS MAIS ATENDIDAS</div>
                <div id="graficoMarcas" style="margin-top: 20px;"></div>

                <div class="action-buttons">
                    <button class="btn-primary" onclick="exportarDados()">üíæ Exportar Todos (JSON)</button>
                    <button class="btn-danger" onclick="limparTodosDados()">üóëÔ∏è Limpar Hist√≥rico</button>
                </div>
            </div>
        </div>

        <!-- ABA OR√áAMENTO ‚Äì PLANILHA DE PE√áAS & SERVI√áOS -->
        <div id="orcamento" class="tab-content">
            <div class="content">
                <div class="section-title">üí∞ PLANILHA DE PE√áAS E SERVI√áOS</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Item</label>
                        <div style="display:flex; gap:10px;">
                            <input type="radio" id="tipoPeca" name="tipoItem" value="peca" checked>
                            <label for="tipoPeca">Pe√ßa</label>

                            <input type="radio" id="tipoServico" name="tipoItem" value="servico">
                            <label for="tipoServico">Servi√ßo</label>
                        </div>
                    </div>
                </div>

                <div class="form-row full">
                    <div class="form-group">
                        <label for="descricaoItem">Descri√ß√£o</label>
                        <textarea id="descricaoItem" rows="1" placeholder="Ex: Pastilha de Freio/M√£o de obra (Enter)..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="valorItem">Valor (R$)</label>
                        <input type="number" id="valorItem" step="0.01" min="0" placeholder="0,00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <button type="button" class="btn-primary" id="btnAdicionarItem" onclick="adicionarItemManual()">
                            ‚ûï Adicionar
                        </button>
                    </div>
                </div>

                <!-- 2. Substitua a tabela antiga por DUAS tabelas novas -->
                <div style="margin-top:20px;">
                    
                    <!-- SE√á√ÉO DE PE√áAS -->
                    <h4 style="border-bottom: 2px solid #e41616; padding-bottom: 5px; color: #333;">üî© Pe√ßas</h4>
                    <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom: 10px;">
                        <thead>
                            <tr style="background:#f7f7f7;">
                                <th style="border:1px solid #ddd; padding:6px; text-align:left;">Descri√ß√£o</th>
                                <th style="border:1px solid #ddd; padding:6px; text-align:right; width: 100px;">Valor</th>
                                <th style="border:1px solid #ddd; padding:6px; text-align:center; width: 50px;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaPecas"></tbody>
                        <tfoot>
                            <tr>
                                <td style="border:1px solid #ddd; padding:6px; text-align:right; font-weight:bold;">Total Pe√ßas:</td>
                                <td id="totalPecas" style="border:1px solid #ddd; padding:6px; text-align:right; font-weight:bold; color: #e41616;">R$ 0,00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- SE√á√ÉO DE SERVI√áOS -->
                    <h4 style="border-bottom: 2px solid #0056b3; padding-bottom: 5px; color: #333; margin-top: 25px;">üîß Servi√ßos</h4>
                    <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom: 10px;">
                        <thead>
                            <tr style="background:#f7f7f7;">
                                <th style="border:1px solid #ddd; padding:6px; text-align:left;">Descri√ß√£o</th>
                                <th style="border:1px solid #ddd; padding:6px; text-align:right; width: 100px;">Valor</th>
                                <th style="border:1px solid #ddd; padding:6px; text-align:center; width: 50px;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaServicos"></tbody>
                        <tfoot>
                            <tr>
                                <td style="border:1px solid #ddd; padding:6px; text-align:right; font-weight:bold;">Total Servi√ßos:</td>
                                <td id="totalServicos" style="border:1px solid #ddd; padding:6px; text-align:right; font-weight:bold; color: #0056b3;">R$ 0,00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- TOTAL GERAL (SOMA DOS DOIS) -->
                    <div style="background: #eee; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: right;">
                        <span style="font-size: 14px; font-weight: bold; color: #555;">TOTAL GERAL (Pe√ßas + Servi√ßos):</span>
                        <div id="totalGeralFinal" style="font-size: 24px; font-weight: bold; color: #28a745;">R$ 0,00</div>
                    </div>

                </div>
                <div class="action-buttons">
                    <button type="button" class="btn-success" onclick="switchTab('resumo'); atualizarResumoOS()">üìÑ Ver Resumo & Imprimir</button>
                </div>
            </div>
        </div>
<!-- ABA FOTOS ‚úÖ PERFEITA -->
<div id="fotos" class="tab-content">
    <div class="content">
        <div class="section-title">üì∏ FOTOS DO VE√çCULO</div>
        
        <!-- RESUMO VE√çCULO -->
        <div class="veiculo-resumo" id="resumoVeiculoFotos">
            <div class="veiculo-resumo-pill">Placa: <strong id="resumoPlaca3">-</strong></div>
            <div class="veiculo-resumo-pill">Modelo: <strong id="resumoModelo3">-</strong></div>
            <div class="veiculo-resumo-pill">Chassi: <strong id="resumoChassi3">-</strong></div>
            <div class="veiculo-resumo-pill">KM: <strong id="resumoKmFotos">-</strong></div>
        </div>

        <!-- BOT√ïES -->
        <div class="form-row">
            <div class="form-group">
                <button type="button" class="btn-primary" onclick="iniciarCamera()">üì∑ Tirar Foto</button>
            </div>
            <div class="form-group">
                <input type="file" id="uploadFotos" multiple accept="image/*" onchange="adicionarFotos(event)">
                <label for="uploadFotos" class="btn-secondary" style="cursor:pointer; padding:12px 24px; display:block; text-align:center;">üìÅ Galeria</label>
            </div>
        </div>

        <!-- C√ÇMERA -->
        <div class="camera-container" style="display:none;">
            <video id="cameraPreview" autoplay playsinline style="width:100%; max-width:400px; height:300px; border-radius:12px; border:3px solid #e41616; background:#000;"></video>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
                <button class="btn-success btn-small" onclick="tirarFoto()" id="btnTirarFoto" style="display:none;">üì∏ Capturar</button>
                <button class="btn-secondary btn-small" onclick="pararCamera()">‚ùå Cancelar</button>
            </div>
        </div>

        <!-- GALERIA -->
        <div class="section-title">Galeria de Fotos (M√°x 15)</div>
        <div id="galeriaFotos" class="fotos-grid"></div>

        <div class="action-buttons">
            <button type="button" class="btn-success" onclick="gerarPDFFotos()">üìÑ PDF Fotos</button>
            <button type="button" class="btn-danger" onclick="limparFotos()">üóëÔ∏è Limpar Fotos</button>
        </div>
    </div>
</div>

    </div>
<!-- ========================================== -->
<!-- NOVA ABA: RESUMO (DOCUMENTO DE IMPRESS√ÉO) -->
<!-- ========================================== -->
<div id="resumo" class="tab-content">
  <div class="content">
    
    <!-- √ÅREA QUE SER√Å IMPRESSA (A FOLHA) -->
    <div id="resumoContainer" class="os-paper">
      
      <!-- CABE√áALHO -->
      <div class="os-header">
        <div class="os-header-left">
          <img id="logoResumo" src="" alt="Logo" class="os-logo">
          <div class="os-empresa-dados">
            <div id="nomeOficinaResumo" class="os-oficina-nome">NOME DA OFICINA</div>
            <div id="enderecoOficinaResumo" class="os-oficina-sub">Endere√ßo da oficina</div>
<div class="os-oficina-sub">
    <img src="whatsapp.png" alt="WhatsApp" class="whatsapp-icon">
    <span id="telefoneOficinaResumo">00 00000-0000</span>
</div>
            <div id="cnpjOficinaResumo" class="os-oficina-sub">CNPJ da oficina</div>
          </div>
        </div>
        <div class="os-header-right">
          <div class="os-label-os">ORDEM DE SERVI√áO</div>
          <div id="osNumero" class="os-numero-os">00000000</div>
        </div>
      </div>

      <!-- DADOS CLIENTE E VE√çCULO (LADO A LADO) -->
      <div class="os-grid-2">
        <div class="os-box">
          <div class="os-box-title">CLIENTE</div>
          <div class="os-line"><strong>Nome:</strong> <span id="rNomeCliente"></span></div>
          <div class="os-line"><strong>CPF/CNPJ:</strong> <span id="rCpfCnpj"></span></div>
          <div class="os-line"><strong>Tel:</strong> <span id="rCelular"></span></div>
        </div>
        <div class="os-box">
          <div class="os-box-title">VE√çCULO</div>
          <div class="os-line"><strong>Ve√≠culo:</strong> <span id="rModelo"></span> <span id="rPlaca" style="background:#eee; padding:0 4px; border-radius:3px; font-weight:bold;"></span></div>
          <div class="os-line"><strong>Chassi:</strong> <span id="rChassi"></span></div>
          <div class="os-line"><strong>KM:</strong> <span id="rKmEntrada"></span> | <strong>Comb:</strong> <span id="rCombustivel"></span></div>
          <div class="os-line"><strong>Data:</strong> <span id="rEntradaDataHora"></span></div>
        </div>
      </div>

      <!-- SERVI√áOS SOLICITADOS -->
      <div class="os-box mt-10">
        <div class="os-box-title">SERVI√áOS SOLICITADOS</div>
        <div id="rServicos" class="os-text-area"></div>
      </div>

      <!-- INSPE√á√ÉO (CHECKLIST) - S√ì O QUE MARCOU -->
      <div class="os-box mt-10">
        <div class="os-box-title">INSPE√á√ÉO DE ENTRADA</div>
        <div id="rChecklistBadges" class="os-badges-area">
          <!-- O Javascript vai preencher aqui -->
        </div>
      </div>
        
<!-- OBSERVA√á√ïES DA INSPE√á√ÉO -->
<div class="os-box mt-10">
    <div class="os-box-title">OBSERVA√á√ïES DA INSPE√á√ÉO</div>
    <div id="rObsInspecao" class="os-text-area">-</div>
</div>

       <!-- ASSINATURAS -->
      <div class="os-assinaturas">
        <div class="os-assina-box">Assinatura do Cliente</div>
        <div class="os-assina-box">Assinatura do T√©cnico</div>
      </div>

   <!-- RODAP√â P√ÅGINA 1 -->
<div class="os-footer">
    <span id="rodape-texto-1">Carregando...</span>
</div>

<div class="force-page-break"></div>


<!-- CABE√áALHO REPETIDO NA P√ÅGINA 2 -->
<div class="os-header">
    <div class="os-header-left">
        <img id="logoResumo2" src="" alt="Logo" class="os-logo">
        <div class="os-empresa-dados">
            <div id="nomeOficinaResumo2" class="os-oficina-nome">NOME DA OFICINA</div>
            <div id="enderecoOficinaResumo2" class="os-oficina-sub">Endere√ßo da oficina</div>
<div class="os-oficina-sub">
    <img src="whatsapp.png" alt="WhatsApp" class="whatsapp-icon">
    <span id="telefoneOficinaResumo2">00 00000-0000</span>
</div>
            <div id="cnpjOficinaResumo2" class="os-oficina-sub">CNPJ da oficina</div>
        </div>
    </div>
    <div class="os-header-right">
        <div class="os-label-os">ORDEM DE SERVI√áO</div>
        <div id="osNumero2" class="os-numero-os">00000000</div>
    </div>
</div>

      <!-- TABELA DE PE√áAS -->
      <div class="mt-10">
         <div class="os-table-header" style="border-bottom: 2px solid #e41616;">PE√áAS</div>
         <table class="os-table" id="rTabelaPecas">
           <!-- O Javascript vai preencher aqui -->
         </table>
         <div class="os-subtotal-row os-subtotal-pecas">
            <span>Total Pe√ßas:</span>
            <span id="rTotalPecas">R$ 0,00</span>
         </div>
      </div>

      <!-- RODAP√â P√ÅGINA 2 -->
      <div class="os-footer">
          <span id="rodape-texto-2">Carregando...</span>
      </div>

<div class="force-page-break"></div>

<!-- CABE√áALHO REPETIDO NA P√ÅGINA 3 -->
<div class="os-header">
    <div class="os-header-left">
        <img id="logoResumo3" src="" alt="Logo" class="os-logo">
        <div class="os-empresa-dados">
            <div id="nomeOficinaResumo3" class="os-oficina-nome">NOME DA OFICINA</div>
            <div id="enderecoOficinaResumo3" class="os-oficina-sub">Endere√ßo da oficina</div>
            <div class="os-oficina-sub">
                <img src="whatsapp.png" alt="WhatsApp" class="whatsapp-icon">
                <span id="telefoneOficinaResumo3">00 00000-0000</span>
            </div>
            <div id="cnpjOficinaResumo3" class="os-oficina-sub">CNPJ da oficina</div>
        </div>
    </div>
    <div class="os-header-right">
        <div class="os-label-os">ORDEM DE SERVI√áO</div>
        <div id="osNumero3" class="os-numero-os">00000000</div>
    </div>
</div>

      <!-- TABELA DE SERVI√áOS -->
      <div class="mt-10">
         <div class="os-table-header" style="border-bottom: 2px solid #0056b3;">SERVI√áOS</div>
         <table class="os-table" id="rTabelaServicos">
           <!-- O Javascript vai preencher aqui -->
         </table>
         <div class="os-subtotal-row os-subtotal-servicos">
            <span>Total Servi√ßos:</span>
            <span id="rTotalServicos">R$ 0,00</span>
         </div>
      </div>

      <!-- TOTAL GERAL -->
      <div class="os-total-row">
        <span>TOTAL GERAL:</span>
        <span id="rTotalGeral" class="os-total-value">R$ 0,00</span>
      </div>

 <!-- ASSINATURAS P√ÅGINA 3 -->
<div class="os-assinaturas">
    <div class="os-assina-box">Assinatura do Cliente</div>
    <div class="os-assina-box">Assinatura do T√©cnico</div>
</div>

        <!-- RODAP√â P√ÅGINA 3 -->
<div class="os-footer">
    <span id="rodape-texto-3">Carregando...</span>
</div>



    </div> <!-- FIM DA FOLHA -->

    <!-- BOT√ïES DE A√á√ÉO DA ABA RESUMO -->
    <div class="action-buttons">
      <button type="button" class="btn-secondary" onclick="imprimirResumo()">üñ®Ô∏è Imprimir</button>
      <button type="button" class="btn-success" onclick="gerarPDFResumo()">üì• Baixar PDF</button>
       <button type="button" class="btn-primary" onclick="salvarChecklist()" style="background: #27ae60 !important;">üíæ Salvar Completo</button>
    </div>

  </div>
</div>

    <script>
function salvarChecklist() {

    const dados = {};

    document.querySelectorAll('input, select, textarea').forEach(el => {

        if (!el.name && !el.id) return;

        let chave = el.name || el.id;

        // NORMALIZA√á√ÉO NA RAIZ - SEMPRE SALVA COMO 'nomecliente'
        if (chave === 'nomecliente') {
            chave = 'nomecliente'; // Garante o nome correto
        }

        if (el.type === 'checkbox') {
            dados[chave] = el.checked;
        } else if (el.type === 'radio') {
            if (el.checked) dados[chave] = el.value;
        } else {
            dados[chave] = el.value;
        }
    });


    // pe√ßas adicionadas dinamicamente
    dados.pecas = [];
    document.querySelectorAll('.linha-peca').forEach(linha => {
        const peca = {};
        linha.querySelectorAll('input, select').forEach(campo => {
            peca[campo.name || campo.className] = campo.value;
        });
        dados.pecas.push(peca);
    });

    // fotos
    dados.fotos = [];
    document.querySelectorAll('#previewFotos img').forEach(img => {
        dados.fotos.push(img.src);
    });

    // salvar local
    localStorage.setItem('checklistSalvo', JSON.stringify(dados));

    alert('Checklist salvo com sucesso.');
}

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-button').forEach(btn => {
                if (btn.getAttribute('onclick').includes(tabId)) btn.classList.add('active');
            });

            if (tabId === 'historico') carregarHistorico();
            if (tabId === 'relatorios') atualizarRelatorios();
            if (tabId === 'orcamento') atualizarResumoVeiculo(); // garante resumo atualizado ao abrir Pe√ßas
        }

        const itensOrcamento = [];

function adicionarItemManual() {
    const descricaoInput = document.getElementById('descricaoItem');
    const valorInput = document.getElementById('valorItem');

    const descricao = descricaoInput.value.trim();
    const valor = parseFloat(valorInput.value);

    if (!descricao) {
        alert('Preencha a descri√ß√£o.');
        descricaoInput.focus();
        return;
    }
    if (isNaN(valor) || valor < 0) {
        alert('Informe um valor v√°lido.');
        valorInput.focus();
        return;
    }

    // Captura qual tipo foi selecionado (radio button)
    const tipo = document.querySelector('input[name="tipoItem"]:checked').value; 

    const item = {
        id: Date.now(),
        descricao,
        valor,
        tipo // salva 'peca' ou 'servico'
    };

    itensOrcamento.push(item);
    renderizarTabela();
    
    descricaoInput.value = '';
    valorInput.value = '';
    descricaoInput.focus();
}

function removerItem(id) {
    itensOrcamento = itensOrcamento.filter(i => i.id !== id);
    renderizarTabela();
}

function renderizarTabela() {
    const tbodyPecas = document.getElementById('tabelaPecas');
    const tbodyServicos = document.getElementById('tabelaServicos');
    
    const elTotalPecas = document.getElementById('totalPecas');
    const elTotalServicos = document.getElementById('totalServicos');
    const elTotalGeral = document.getElementById('totalGeralFinal');

    // Limpa tabelas
    if(tbodyPecas) tbodyPecas.innerHTML = '';
    if(tbodyServicos) tbodyServicos.innerHTML = '';

    let somaPecas = 0;
    let somaServicos = 0;

    itensOrcamento.forEach(item => {
        const tr = document.createElement('tr');
        
       tr.innerHTML = `
    <td style="border:1px solid #ddd; padding:6px;">${item.descricao}</td>
    <td style="border:1px solid #ddd; padding:6px; text-align:right;">R$ ${item.valor.toFixed(2)}</td>
    <td style="border:1px solid #ddd; padding:6px; text-align:center;">
        <button class="btn-small btn-warning" onclick="editarItem(${item.id})" title="Editar">‚úèÔ∏è</button>
        <button class="btn-small btn-danger" onclick="removerItem(${item.id})" title="Apagar">üóëÔ∏è</button>
    </td>
`;


        if (item.tipo === 'servico') {
            somaServicos += item.valor;
            if(tbodyServicos) tbodyServicos.appendChild(tr);
        } else {
            // Default √© pe√ßa
            somaPecas += item.valor;
            if(tbodyPecas) tbodyPecas.appendChild(tr);
        }
    });

    // Atualiza totais na tela
    if(elTotalPecas) elTotalPecas.textContent = 'R$ ' + somaPecas.toFixed(2);
    if(elTotalServicos) elTotalServicos.textContent = 'R$ ' + somaServicos.toFixed(2);
    
    const somaTotal = somaPecas + somaServicos;
    if(elTotalGeral) elTotalGeral.textContent = 'R$ ' + somaTotal.toFixed(2);
}

        // ENTER nos campos de Pe√ßas & Servi√ßos adiciona linha
        document.addEventListener('DOMContentLoaded', () => {
            carregarHistorico();
            atualizarResumoVeiculo();

            const descricaoItem = document.getElementById('descricaoItem');
            const valorItem = document.getElementById('valorItem');

            if (descricaoItem) {
                descricaoItem.addEventListener('keydown', function (event) {
                    if (event.key === 'Enter' && !event.shiftKey) {
                        event.preventDefault();
                        if (valorItem) {
                            valorItem.focus();
                        }
                    }
                });
            }

            if (valorItem) {
                valorItem.addEventListener('keydown', function (event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        const btnAdicionar = document.getElementById('btnAdicionarItem');
                        if (btnAdicionar) {
                            btnAdicionar.click();
                        } else {
                            adicionarItemManual();
                        }
                        if (descricaoItem) {
                            setTimeout(function() {
                                descricaoItem.focus();
                            }, 100);
                        }
                    }
                });
            }

            const camposResumo = ['placa','modelo','chassi','km_entrada','data','hora','combustivel','complexidade'];
            camposResumo.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const tipo = (el.tagName === 'SELECT' || el.type === 'date' || el.type === 'time') ? 'change' : 'input';
                el.addEventListener(tipo, atualizarResumoVeiculo);
                el.addEventListener('blur', atualizarResumoVeiculo);
            });
        });

        function atualizarResumoVeiculo() {
            const placa = document.getElementById('placa')?.value || '-';
            const modelo = document.getElementById('modelo')?.value || '-';
            const chassi = document.getElementById('chassi')?.value || '-';
            const kmEntrada = document.getElementById('km_entrada')?.value || '-';
            const data = document.getElementById('data')?.value || '-';
            const hora = document.getElementById('hora')?.value || '-';

            document.getElementById('resumoPlaca').textContent = placa.toUpperCase();
            document.getElementById('resumoPlaca2').textContent = placa.toUpperCase();
            document.getElementById('resumoPlaca3').textContent = placa.toUpperCase();
            document.getElementById('resumoModelo').textContent = modelo;
            document.getElementById('resumoModelo2').textContent = modelo;
            document.getElementById('resumoModelo3').textContent = modelo;
            document.getElementById('resumoChassi2').textContent = chassi;
            document.getElementById('resumoChassi3').textContent = chassi;
            document.getElementById('resumoKmEntrada').textContent = kmEntrada;
            document.getElementById('resumoKmFotos').textContent = kmEntrada;

            const dataHora = data && hora ? `${data.split('-').reverse().join('/')}, ${hora}` : data ? data.split('-').reverse().join('/') : '-';
            document.getElementById('resumoData').textContent = dataHora;
        }

        function limparFormulario() {
            document.getElementById('checklistForm').reset();
            document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.querySelectorAll('.step-indicator').forEach(el => el.classList.remove('active'));
            document.querySelector('.step-indicator').classList.add('active');
            atualizarResumoVeiculo();
            mostrarAlerta('info', 'Formul√°rio limpo. Voc√™ pode iniciar um novo checklist.');
        }

        // ========================
        // FUN√á√ïES DE FOTOS
        // ========================

        let fotos = [];
        let stream = null;

        function iniciarCamera() {
            const cameraContainer = document.querySelector('.camera-container');
            const preview = document.getElementById('cameraPreview');
            const btnTirar = document.getElementById('btnTirarFoto');

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(s => {
                    stream = s;
                    preview.srcObject = stream;
                    cameraContainer.style.display = 'block';
                    btnTirar.style.display = 'inline-block';
                })
                .catch(err => {
                    alert('Erro ao acessar c√¢mera: ' + err);
                });
        }

        function tirarFoto() {
            const preview = document.getElementById('cameraPreview');
            const canvas = document.createElement('canvas');
            canvas.width = preview.videoWidth;
            canvas.height = preview.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
            const dataURL = canvas.toDataURL('image/jpeg', 0.8);
            fotos.push({ dataURL, data: new Date().toLocaleString() });
            renderizarGaleria();
        }

        function pararCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            document.querySelector('.camera-container').style.display = 'none';
        }

        function adicionarFotos(event) {
            const arquivos = Array.from(event.target.files);
            arquivos.forEach(arquivo => {
                const reader = new FileReader();
                reader.onload = e => {
                    fotos.push({ dataURL: e.target.result, data: new Date().toLocaleString() });
                    renderizarGaleria();
                };
                reader.readAsDataURL(arquivo);
            });
        }

        function renderizarGaleria() {
            const galeria = document.getElementById('galeriaFotos');
            galeria.innerHTML = '';
            fotos.forEach((foto, index) => {
                const item = document.createElement('div');
                item.className = 'foto-item';

                item.innerHTML = `
                    <img src="${foto.dataURL}" alt="Foto ${index + 1}">
                    <div class="foto-overlay">Foto ${index + 1}</div>
                    <div class="foto-actions">
                        <button class="btn-foto btn-danger" onclick="removerFoto(${index})">üóëÔ∏è</button>
                    </div>
                `;

                galeria.appendChild(item);
            });
        }

        function removerFoto(index) {
            fotos.splice(index, 1);
            renderizarGaleria();
        }

        function limparFotos() {
            if (confirm('Deseja remover todas as fotos?')) {
                fotos = [];
                renderizarGaleria();
            }
        }

        function gerarPDFFotos() {
            if (fotos.length === 0) {
                alert('Nenhuma foto para gerar PDF.');
                return;
            }

            const placa = document.getElementById('placa')?.value?.toUpperCase() || 'SEM-PLACA';
            const nomeCliente = document.getElementById('nome_cliente')?.value || 'Cliente';

            const fotosUsar = fotos.slice(0, 16); // m√°ximo 16

            let html = `
                <div style="font-family: Arial, sans-serif; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="margin:0; color:#e41616;">FOTOS DO VE√çCULO</h2>
                        <p style="margin:5px 0; font-size:12px;">Placa: ${placa} | Cliente: ${nomeCliente}</p>
                        <hr>
                    </div>
            `;

            // 4 fotos por p√°gina
            for (let i = 0; i < fotosUsar.length; i += 4) {
                html += `
                    <div style="page-break-after: always;">
                        <div style="
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            margin-bottom: 20px;
                        ">
                `;

                for (let j = 0; j < 4 && i + j < fotosUsar.length; j++) {
                    const foto = fotosUsar[i + j];
                    const num = i + j + 1;

                    html += `
                        <div style="text-align: center;">
                            <img src="${foto.dataURL}"
                                 style="
                                     width: 100%;
                                     max-width: 260px;
                                     max-height: 260px;
                                     height: auto;
                                     border-radius: 6px;
                                     border: 1px solid #e41616;
                                 ">
                            <div style="
                                font-size: 9px;
                                margin-top: 5px;
                                color: #555;
                            ">
                                Foto ${num} - ${foto.data || ''}
                            </div>
                        </div>
                    `;
                }

                html += `
                        </div>
                    </div>
                `;
            }

            html2pdf().set({
                filename: `Fotos-${placa}.pdf`,
                margin: 0,
                image: { type: 'jpeg', quality: 0.9 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    scrollY: 0
                },
                jsPDF: {
                    format: 'a4',
                    orientation: 'portrait',
                    unit: 'pt'
                }
            }).from(html).save();

            mostrarAlerta('success', `‚úÖ PDF gerado com ${fotosUsar.length} fotos (m√°ximo 16)`);
        }

        // INICIALIZAR FOTOS
        document.addEventListener('DOMContentLoaded', () => {
            renderizarGaleria();
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,CmNvbnN0IENBQ0hFX05BTUUgPSAnY2hlY2tsaXN0LXYzLWNhY2hlJzsKY29uc3QgVVJMU19UT19DQUNIRSA9IFsKICAnLycsCiAgJy9pbmRleC5odG1sJwpdOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGV2ZW50KSA9PiB7CiAgY29uc3QgY2FjaGVPcGVuID0gY2FjaGVzLm9wZW4oQ0FDSEVfTkFNRSkudGhlbigY2xpZW50KSA9PiB7CiAgICByZXR1cm4gY2xpZW50LmFkZEFsbChVUkxzX1RPX0NBQ0hFKTsKICB9KTsKICBldmVudC53YWl0VW50aWwoKGNhY2hlT3Blbik7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIChldmVudCkgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKAogICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgfQogICAgICByZXR1cm4gZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICB9KQogICk7Cn0pOwo=');
        }
    // ==========================================
    // FUN√á√ïES DA NOVA ABA RESUMO (COLE NO FINAL DO SCRIPT)
    // ==========================================

    function gerarNumeroOS() {
        // Pega a placa e remove tra√ßos
        const placa = (document.getElementById('placa')?.value || 'OS').replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
        
        // Pega a data (se vazia, usa hoje)
        let dataRaw = document.getElementById('data')?.value;
        let dataObj = dataRaw ? new Date(dataRaw + 'T00:00:00') : new Date();
        
        // Formata ddmmyyyy
        const dia = String(dataObj.getDate()).padStart(2, '0');
        const mes = String(dataObj.getMonth() + 1).padStart(2, '0');
        const ano = String(dataObj.getFullYear());
        
        // Retorna PLACA + DATA (Ex: OOX561229012026)
        return `${placa}${dia}${mes}${ano}`;
    }
            // ATUALIZA A BARRA FIXA SEMPRE QUE MUDAR PLACA OU DATA
    document.addEventListener('input', function(e) {
        if (e.target.id === 'placa' || e.target.id === 'data') {
            atualizarBarraOS();
        }
    });

    function atualizarBarraOS() {
        const os = gerarNumeroOS(); // Usa sua fun√ß√£o existente
        const el = document.getElementById('barraFixaOS');
        if (el) el.textContent = os;
    }

    // Chama uma vez ao carregar
    atualizarBarraOS();


    function atualizarResumoOS() {
        // === 1. CABE√áALHO E DADOS B√ÅSICOS ===
        // Logo e Empresa
        const logoSrc = document.getElementById('logo-oficina')?.src;
        if (logoSrc) document.getElementById('logoResumo').src = logoSrc;
        
        document.getElementById('nomeOficinaResumo').textContent = document.getElementById('nome-oficina')?.textContent || 'OFICINA';
        document.getElementById('enderecoOficinaResumo').textContent = document.getElementById('endereco-oficina')?.textContent || '';
        document.getElementById('telefoneOficinaResumo').textContent = document.getElementById('telefone-oficina')?.textContent || '';
        document.getElementById('cnpjOficinaResumo').textContent = document.getElementById('cnpj-oficina')?.textContent || 'CNPJ da oficina';
        
        // N√∫mero da OS
        document.getElementById('osNumero').textContent = gerarNumeroOS();

            // === CABE√áALHO DA P√ÅGINA 2 (C√ìPIA DO PRIMEIRO) ===
        const logoResumo2 = document.getElementById('logoResumo2');
        const nomeOficinaResumo2 = document.getElementById('nomeOficinaResumo2');
        const enderecoOficinaResumo2 = document.getElementById('enderecoOficinaResumo2');
        const telefoneOficinaResumo2 = document.getElementById('telefoneOficinaResumo2');
        const cnpjOficinaResumo2 = document.getElementById('cnpjOficinaResumo2');
        const osNumero2 = document.getElementById('osNumero2');
        const logoResumo3 = document.getElementById('logoResumo3');
        const nomeOficinaResumo3 = document.getElementById('nomeOficinaResumo3');
        const enderecoOficinaResumo3 = document.getElementById('enderecoOficinaResumo3');
        const telefoneOficinaResumo3 = document.getElementById('telefoneOficinaResumo3');
        const cnpjOficinaResumo3 = document.getElementById('cnpjOficinaResumo3');
        const osNumero3 = document.getElementById('osNumero3');

        if (logoResumo2 && document.getElementById('logoResumo')) {
            logoResumo2.src = document.getElementById('logoResumo').src;
        }
        if (nomeOficinaResumo2 && document.getElementById('nomeOficinaResumo')) {
            nomeOficinaResumo2.textContent =
                document.getElementById('nomeOficinaResumo').textContent;
        }
        if (enderecoOficinaResumo2 && document.getElementById('enderecoOficinaResumo')) {
            enderecoOficinaResumo2.textContent =
                document.getElementById('enderecoOficinaResumo').textContent;
        }
        if (telefoneOficinaResumo2 && document.getElementById('telefoneOficinaResumo')) {
            telefoneOficinaResumo2.textContent =
                document.getElementById('telefoneOficinaResumo').textContent;
        }
        if (cnpjOficinaResumo2 && document.getElementById('cnpjOficinaResumo')) {
            cnpjOficinaResumo2.textContent =
                document.getElementById('cnpjOficinaResumo').textContent;
        }
        if (osNumero2 && document.getElementById('osNumero')) {
            osNumero2.textContent =
                document.getElementById('osNumero').textContent;
        }
        if (logoResumo3 && document.getElementById('logoResumo')) {
            logoResumo3.src = document.getElementById('logoResumo').src;
        }
        if (nomeOficinaResumo3 && document.getElementById('nomeOficinaResumo')) {
            nomeOficinaResumo3.textContent =
                document.getElementById('nomeOficinaResumo').textContent;
        }
        if (enderecoOficinaResumo3 && document.getElementById('enderecoOficinaResumo')) {
            enderecoOficinaResumo3.textContent =
                document.getElementById('enderecoOficinaResumo').textContent;
        }
        if (telefoneOficinaResumo3 && document.getElementById('telefoneOficinaResumo')) {
            telefoneOficinaResumo3.textContent =
                document.getElementById('telefoneOficinaResumo').textContent;
        }
        if (cnpjOficinaResumo3 && document.getElementById('cnpjOficinaResumo')) {
            cnpjOficinaResumo3.textContent =
                document.getElementById('cnpjOficinaResumo').textContent;
        }
        if (osNumero3 && document.getElementById('osNumero')) {
            osNumero3.textContent =
                document.getElementById('osNumero').textContent;
        }

        // DAQUI PARA BAIXO CONTINUA O C√ìDIGO QUE J√Å EXISTE (CLIENTE/VE√çCULO)
        // document.getElementById('rNomeCliente').textContent = ...


        // Cliente
        
    document.getElementById('rNomeCliente').textContent = document.getElementById('nome_cliente')?.value || '-';
    document.getElementById('rCpfCnpj').textContent = document.getElementById('cpf_cnpj')?.value || '-';
    document.getElementById('rCelular').textContent = document.getElementById('celular_cliente')?.value || '-';



        // Ve√≠culo
        document.getElementById('rModelo').textContent = document.getElementById('modelo')?.value || '-';
        document.getElementById('rPlaca').textContent = (document.getElementById('placa')?.value || '-').toUpperCase();
        document.getElementById('rChassi').textContent = document.getElementById('chassi')?.value || '-';
        document.getElementById('rKmEntrada').textContent = (document.getElementById('kmentrada')?.value || '') + ' km';
        
        // Combust√≠vel (Select)
        let combSelect = document.getElementById('combustivel');
        let combTexto = combSelect && combSelect.selectedIndex >= 0 ? combSelect.options[combSelect.selectedIndex].text : '-';
        document.getElementById('rCombustivel').textContent = combTexto;

        // Data/Hora
        let dataVal = document.getElementById('data')?.value;
        let horaVal = document.getElementById('hora')?.value;
        let dataFmt = dataVal ? dataVal.split('-').reverse().join('/') : '--/--/----';
        document.getElementById('rEntradaDataHora').textContent = `${dataFmt} √†s ${horaVal || '--:--'}`;

        // Servi√ßos Solicitados
        document.getElementById('rServicos').textContent = document.getElementById('servicos')?.value || '-';

        // Observa√ß√µes da Inspe√ß√£o
    const obs = document.getElementById('obsInspecao')?.value || '-';
    if (document.getElementById('rObsInspecao')) {
        document.getElementById('rObsInspecao').textContent = obs;
    }


        // === 2. INSPE√á√ÉO (CHECKBOXES) - L√ìGICA REFOR√áADA ===
        const areaBadges = document.getElementById('rChecklistBadges');
        areaBadges.innerHTML = ''; // Limpa tudo antes de come√ßar

        // Pega todos os checkboxes marcados dentro do formul√°rio
        const checkboxesMarcados = document.querySelectorAll('#checklistForm input[type="checkbox"]:checked');

        if (checkboxesMarcados.length === 0) {
            areaBadges.innerHTML = '<span style="color:#999; font-size:11px;">Nenhum item inspecionado/marcado.</span>';
        } else {
            checkboxesMarcados.forEach(cb => {
                // Tenta achar o texto: 1¬∫ no Label 'for', 2¬∫ no texto logo depois do input, 3¬∫ no value
                let textoLabel = cb.value; // Valor padr√£o (ex: ESTEPE)
                
                // Tenta pegar o label associado
                let labelTag = document.querySelector(`label[for="${cb.id}"]`);
                if (labelTag) {
                    textoLabel = labelTag.textContent;
                } else if (cb.nextElementSibling && cb.nextElementSibling.tagName === 'LABEL') {
                    // Tenta pegar o pr√≥ximo elemento se for label
                    textoLabel = cb.nextElementSibling.textContent;
                }

                // Limpa o texto (tira espa√ßos extras)
                textoLabel = textoLabel.trim();

                // Cria o selo colorido
                let span = document.createElement('span');
                
                // Palavras chave para pintar de vermelho
                const palavrasRuim = ['TRINCADO', 'AMASSADO', 'RISCADO', 'QUEBRADO', 'DANIFICADO', 'FALTANDO', 'RUIM'];
                const ehRuim = palavrasRuim.some(p => textoLabel.toUpperCase().includes(p));

                span.className = ehRuim ? 'os-badge no' : 'os-badge ok';
                span.innerHTML = ehRuim ? `‚ö†Ô∏è ${textoLabel}` : `‚úÖ ${textoLabel}`;
                
                areaBadges.appendChild(span);
            });
        }

        // === 3. TABELAS DE OR√áAMENTO (Clona o HTML da aba Or√ßamento) ===
        // PE√áAS
        const origemPecas = document.getElementById('tabelaPecas'); // Tbody original
        const destinoPecas = document.getElementById('rTabelaPecas'); // Tabela no resumo
        destinoPecas.innerHTML = ''; 

        if (origemPecas && origemPecas.rows.length > 0) {
            // Copia linha por linha, mas remove o bot√£o de excluir
            Array.from(origemPecas.rows).forEach(row => {
                let desc = row.cells[0].textContent;
                let valor = row.cells[1].textContent;
                // Cria nova linha limpa
                destinoPecas.innerHTML += `<tr><td>${desc}</td><td style="text-align:right;">${valor}</td></tr>`;
            });
        } else {
            destinoPecas.innerHTML = '<tr><td colspan="2" style="color:#999; text-align:center;">-</td></tr>';
        }

        // SERVI√áOS
        const origemServicos = document.getElementById('tabelaServicos');
        const destinoServicos = document.getElementById('rTabelaServicos');
        destinoServicos.innerHTML = '';

        if (origemServicos && origemServicos.rows.length > 0) {
            Array.from(origemServicos.rows).forEach(row => {
                let desc = row.cells[0].textContent;
                let valor = row.cells[1].textContent;
                destinoServicos.innerHTML += `<tr><td>${desc}</td><td style="text-align:right;">${valor}</td></tr>`;
            });
        } else {
            destinoServicos.innerHTML = '<tr><td colspan="2" style="color:#999; text-align:center;">-</td></tr>';
        }

        // TOTAL GERAL
        const totalGeral = document.getElementById('totalGeralFinal');
        document.getElementById('rTotalGeral').textContent = totalGeral ? totalGeral.textContent : 'R$ 0,00';
        const totalPecas = document.getElementById('totalPecas');
        const totalServicos = document.getElementById('totalServicos');
        if (document.getElementById('rTotalPecas')) {
            document.getElementById('rTotalPecas').textContent = totalPecas ? totalPecas.textContent : 'R$ 0,00';
        }
        if (document.getElementById('rTotalServicos')) {
            document.getElementById('rTotalServicos').textContent = totalServicos ? totalServicos.textContent : 'R$ 0,00';
        }
        
    // RODAP√â - MESMO TEXTO NAS DUAS P√ÅGINAS
    const textoRodape = `Checklist gerado por ${document.getElementById('nome-oficina')?.textContent || 'Oficina'} CNPJ ${document.getElementById('cnpj-oficina')?.textContent || ''} - ${new Date().toLocaleString('pt-BR')}`;

    const rod1 = document.getElementById('rodape-texto-1');
    const rod2 = document.getElementById('rodape-texto-2');
    const rod3 = document.getElementById('rodape-texto-3');

    if (rod1) rod1.textContent = textoRodape;
    if (rod2) rod2.textContent = textoRodape;
    if (rod3) rod3.textContent = textoRodape;
    }


    function imprimirResumo() {
        atualizarResumoOS(); // Garante que est√° atualizado
        window.print(); // O CSS @media print far√° o resto (esconder o resto do site)
    }

    function gerarPDFResumo() {
        atualizarResumoOS();  // Garante dados atualizados

        const elemento = document.getElementById('resumoContainer');
        
        const opt = {
            margin: [10, 10, 10, 10],  // Margens em mm: top, right, bottom, left
            filename: 'OS-' + document.getElementById('placa')?.value?.toUpperCase() + '_CHECKLIST.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { 
                scale: 2, 
                useCORS: true, 
                scrollY: 0,
                backgroundColor: '#ffffff',
                letterRendering: true
            },
            jsPDF: { 
                unit: 'mm', 
                format: 'a4', 
                orientation: 'portrait' 
            },
            pagebreak: { mode: 'css', legacy: true },  // Quebras autom√°ticas
            pdfCallback: function(pdfObject) {
                // Fun√ß√£o que roda AP√ìS gerar o PDF - adiciona header/footer em TODAS as p√°ginas
                var totalPages = pdfObject.internal.getNumberOfPages();
                
                // Conte√∫do do HEADER (ajuste posi√ß√µes em mm para A4 portrait: largura 210mm)
                var headerText = document.getElementById('nomeOficinaResumo')?.textContent || 'OFICINA';
                var osNumero = document.getElementById('osNumero')?.textContent || '';
                
                // Conte√∫do do FOOTER
                var footerText = document.getElementById('rodape-texto')?.textContent || 'Checklist gerado em ' + new Date().toLocaleString('pt-BR');
                
                for (var i = 1; i <= totalPages; i++) {  // Loop em todas as p√°ginas (1-indexed)
                    pdfObject.setPage(i);
                    
                    // HEADER: topo da p√°gina (posi√ß√£o Y ~10mm)
                    pdfObject.setFontSize(14);
                    pdfObject.setFont('helvetica', 'bold');
                    pdfObject.setTextColor(50, 50, 50);  // Cor escura
                    pdfObject.text(headerText.toUpperCase(), 15, 12);  // Esquerda
                    pdfObject.text('ORDEM DE SERVI√áO: ' + osNumero, 150, 12);  // Direita
                    
                    // Linha separadora
                    pdfObject.setDrawColor(200, 200, 200);
                    pdfObject.setLineWidth(0.5);
                    pdfObject.line(10, 15, 200, 15);
                    
                    // FOOTER: fundo da p√°gina (posi√ß√£o Y ~287mm para A4 297mm)
                    pdfObject.setFontSize(9);
                    pdfObject.setFont('helvetica', 'normal');
                    pdfObject.setTextColor(100, 100, 100);
                    pdfObject.text(footerText, 15, 287);
                    pdfObject.text('P√°gina ' + i + ' de ' + totalPages, 170, 287);  // Numera√ß√£o
                }
            }
        };
        
        html2pdf().set(opt).from(elemento).save();
    }


            function editarItem(id) {
        const item = itensOrcamento.find(i => i.id === id);
        if (!item) return;
        
        // Preenche os campos pra editar
        document.getElementById('descricaoItem').value = item.descricao;
        document.getElementById('valorItem').value = item.valor;
        document.querySelector(`input[name="tipoItem"][value="${item.tipo}"]`).checked = true;
        
        // Remove o antigo (vai adicionar novo clicando "Adicionar")
        removerItem(id);
        
        alert('Item carregado para edi√ß√£o. Altere e clique ‚ûï Adicionar!');
    }

            function editarItem(id) {
        const item = itensOrcamento.find(i => i.id === id);
        document.getElementById('descricaoItem').value = item.descricao;
        document.getElementById('valorItem').value = item.valor;
        document.querySelector(`input[name="tipoItem"][value="${item.tipo}"]`).checked = true;
        removerItem(id);
    }

    // ========================
    // CONTROLE DO WIZARD (PASSO A PASSO)
    // ========================

    function showStep(stepNumber) {
        // 1. Esconde todos os passos
        document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active'));
        
        // 2. Mostra o passo atual
        document.getElementById('step' + stepNumber).classList.add('active');
        
        // 3. Atualiza a barra de topo (bolinhas)
        document.querySelectorAll('.step-indicator').forEach(el => {
            el.classList.remove('active');
            if (el.dataset.step == stepNumber) el.classList.add('active');
        });

        // Rola para o topo suavemente para o usu√°rio ver o in√≠cio do formul√°rio
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function nextStep(step) {
        // Valida√ß√£o Opcional: Obrigar digitar placa no passo 1
        if (step === 2) {
            const placa = document.getElementById('placa').value;
            if (!placa) {
                alert('‚ö†Ô∏è Por favor, digite a PLACA antes de continuar.');
                document.getElementById('placa').focus();
                return;
            }
        }
        showStep(step);
    }

    function prevStep(step) {
        showStep(step);
    }

        </script>
        
    <script src="config.js"></script>
    <script src="app.js"></script>
        
        <!-- RODAP√â FIXO -->
    <div class="os-footer" id="rRodape" style="position: fixed; bottom: 0; left: 0; right: 0; width: 100%; text-align: center; font-size: 10px; background: #f8f9fa; padding: 8px 12px; border-top: 2px solid var(--color-primary); z-index: 9999; box-sizing: border-box; font-family: Arial, sans-serif;">
        <span id="rodape-texto">Developed by Hallz Branding 3199676-6963</span>
    </div>

    </body>
    </html>
